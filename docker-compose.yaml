services:
  api:
    build: .
    ports:
      - "8000:8080"
    env_file: .env
    environment:
      - ENV=development
      - INFRAPROBE_DEV_BYPASS_AUTH=true
      - INFRAPROBE_JOB_STORE_BACKEND=memory

  # Local Firestore emulator for integration tests.
  # Start with: docker compose up firestore
  # Then run tests: FIRESTORE_EMULATOR_HOST=localhost:8686 uv run pytest tests/test_storage_firestore.py
  firestore:
    image: google/cloud-sdk:slim
    command: gcloud emulators firestore start --host-port=0.0.0.0:8686 --quiet
    ports:
      - "8686:8686"
    profiles:
      - firestore
